<!DOCTYPE html>
<html>
<head>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <title>Team Shape Selection 2025</title>
 <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
 <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
 <style>
  *{box-sizing:border-box}
  body{font-family:'Montserrat',sans-serif;margin:0;padding:20px;background:#f8f9ff;text-align:center;overflow-x:hidden}
  h1{
   font-size:2.7rem;font-weight:900;color:transparent;
   background:linear-gradient(90deg,#ee4d2d,#ff6b6b,#ee4d2d);
   background-size:200%;-webkit-background-clip:text;background-clip:text;
   animation:sh 5s linear infinite;margin:40px 0 50px;letter-spacing:2px
  }
  @keyframes sh{0%{background-position:200% 0}100%{background-position:-200% 0}}

  select{
   padding:18px;font-size:1.2rem;border-radius:16px;border:none;background:#1a73e8;color:#fff;
   font-weight:700;width:90%;max-width:360px;margin:20px auto;display:block
  }

  .images{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:25px;margin:60px auto}
  .box{
   border:6px solid #ddd;border-radius:22px;overflow:hidden;background:#fff;
   box-shadow:0 12px 35px rgba(0,0,0,.15);transition:.3s;cursor:pointer
  }
  .box:hover{transform:scale(1.06);border-color:#ee4d2d}
  .box img{width:100%;height:230px;object-fit:cover}
  .label{padding:16px;background:#ee4d2d;color:#fff;font-weight:bold;font-size:1.2rem}
  .taken{border-color:#113366!important;opacity:0.7;pointer-events:none}
  .taken .label{background:#113366}

  .popup-overlay{
   position:fixed;inset:0;background:#fff;display:flex;align-items:center;justify-content:center;
   opacity:0;visibility:hidden;transition:opacity .7s;z-index:9999
  }
  .popup{
   width:95%;max-width:460px;text-align:center;padding:60px 30px
  }
  .popup h2{font-size:3rem;color:#ee4d2d;font-weight:900;margin:0 0 45px}
  .popup-shape-img{
   width:140px;height:140px;border-radius:50%;object-fit:cover;
   border:10px solid #ee4d2d;margin:30px auto 40px;
   box-shadow:0 20px 50px rgba(238,77,45,.6)
  }
  .shape-name{font-size:5.2rem;font-weight:900;color:#ee4d2d;margin:20px 0 15px}
  .team-text{font-size:1.8rem;color:#333;margin:30px 0 60px;line-height:1.6}
  .team-name{color:#ee4d2d;font-weight:900;font-size:2.6rem}
  .popup button{
   background:#ee4d2d;color:#fff;padding:22px 120px;font-size:1.9rem;
   font-weight:700;border-radius:80px;border:none;cursor:pointer;
   box-shadow:0 20px 50px rgba(238,77,45,.6)
  }
 </style>
</head>
<body>

<h1>Team Shape Selection 2025</h1>

<div id="step1">
 <strong style="font-size:1.5rem">Choose your team</strong><br><br>
 <select id="team" onchange="pickTeam()">
  <option value="">-- Select Team --</option>
  <option>BD</option><option>CP</option><option>Driver</option>
  <option>Ops</option><option>People</option><option>Product</option>
  <option>S&P - Budget & Merchant</option>
  <option>S&P - Demand</option><option>S&P - Platform Health</option>
 </select>
</div>

<div id="step2" style="display:none">
 <p style="font-size:1.55rem;margin:40px 0"><strong><span id="teamName"></span> — Choose your team shape!</strong></p>
 <div class="images" id="grid"></div>
 <button onclick="location.reload()">Change Team</button>
</div>

<div id="admin" style="margin:90px 0 40px;font-size:1.5rem">
 <a href="#" onclick="showResults();return false;">Owner: View all choices</a>
</div>

<div class="popup-overlay" id="popup">
 <div class="popup">
  <h2>Congratulations!</h2>
  <div id="popupImageContainer"></div>
  <div class="shape-name" id="selectedShape"></div>
  <div class="team-text">
   is selected to represent<br>
   <span class="team-name" id="selectedTeam"></span> team
  </div>
  <button onclick="closePopup()">Got it!</button>
 </div>
</div>

<script>
const shapeNames = ["ARROW","CIRCLE","CRESCENT","CROSS","HEART","HEXAGON","OVAL","PENTAGON","PIE","RECTANGLE","STAR","SQUARE","SPIRAL","RIGHT TRIANGLE","RHOMBUS"];
const imageFiles = shapeNames.map(n => `image/${n}`);

const teams = ["S&P - Budget & Merchant","S&P - Demand","S&P - Platform Health","BD","CP","Driver","Ops","Product","People"];
let choices = JSON.parse(localStorage.getItem("choices2025")) || {};

let currentTeam = "";

function pickTeam() {
 currentTeam = document.getElementById("team").value;
 if (!currentTeam) return;
 if (choices[currentTeam]) {
  alert("This team already picked a shape!");
  document.getElementById("team").selectedIndex = 0;
  return;
 }
 document.getElementById("step1").style.display = "none";
 document.getElementById("step2").style.display = "block";
 document.getElementById("teamName").textContent = currentTeam;
 loadImages();
}

function loadImages() {
 const grid = document.getElementById("grid");
 grid.innerHTML = "";
 imageFiles.forEach(file => {
  const name = file.split('/').pop();
  const taken = Object.keys(choices).find(t => choices[t] === file);
  const box = document.createElement("div");
  box.className = "box" + (taken ? " taken" : "");
  box.innerHTML = `
   <img src="${file}.jpg" onerror="this.src='${file}.png'" onerror="this.src='${file}.webp'">
   <div class="label">${taken ? "Taken by "+taken : name}</div>
  `;
  if (!taken) box.onclick = () => selectImage(currentTeam, file, name);  // ← FIXED HERE
  grid.appendChild(box);
 });
}

function selectImage(team, file, shapeName) {
 if (choices[team]) return;
 choices[team] = file;
 localStorage.setItem("choices2025", JSON.stringify(choices));

 document.getElementById("popupImageContainer").innerHTML = `
  <img class="popup-shape-img" src="${file}.jpg"
       onerror="this.src='${file}.png'"
       onerror="this.src='${file}.webp'">
 `;

 document.getElementById("selectedShape").textContent = shapeName;
 document.getElementById("selectedTeam").textContent = team;

 document.getElementById("popup").style.opacity = "1";
 document.getElementById("popup").style.visibility = "visible";

 confetti({particleCount:400,spread:120,origin:{y:0.55},colors:['#ee4d2d','#ff6b6b','#1a73e8']});
}

function closePopup() {
 document.getElementById("popup").style.opacity = "0";
 setTimeout(() => location.reload(), 800);
}

function showResults() {
 let txt = "TEAM SHAPE SELECTIONS 2025\n\n";
 teams.forEach(t => txt += `${t} → ${choices[t]?choices[t].split('/').pop():"Not chosen yet"}\n`);
 alert(txt);
}
</script>
</body>
</html>