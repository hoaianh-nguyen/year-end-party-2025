<!DOCTYPE html>
<html>
<head>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <title>Team Shape Selection 2025</title>
 <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;900&display=swap" rel="stylesheet">
 <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
 <style>
  *{box-sizing:border-box}
  body{font-family:'Montserrat',sans-serif;margin:0;padding:20px;background:#f8f9ff;text-align:center;position:relative}
  h1{color:#ee4d2d;font-weight:900;font-size:2.4rem;margin:40px 0}
  select,button{padding:16px 20px;font-size:1.1rem;border-radius:14px;border:none;background:#1a73e8;color:white;font-weight:700;width:90%;max-width:340px}
  @media(max-width:480px){h1{font-size:2rem}}
  .images{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:25px;margin:50px auto;padding:0 10px}
  @media(max-width:640px){.images{grid-template-columns:1fr 1fr}}
  @media(max-width:480px){.images{grid-template-columns:1fr}}
  .box{border:6px solid #ddd;border-radius:20px;overflow:hidden;background:white;box-shadow:0 12px 35px rgba(0,0,0,.15);transition:.3s;cursor:pointer}
  .box:hover{transform:scale(1.06);border-color:#ee4d2d}
  .box img{width:100%;height:220px;object-fit:cover}
  .label{padding:15px;background:#ee4d2d;color:white;font-weight:bold;font-size:1.1rem}
  .taken{border-color:#113366 !important;opacity:0.7;pointer-events:none}
  .taken .label{background:#113366}
  .popup-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);backdrop-filter:blur(12px);display:flex;align-items:center;justify-content:center;padding:20px;opacity:0;visibility:hidden;transition:opacity .5s;z-index:9999}
  .popup{background:#fff;border-radius:28px;padding:60px 30px 50px;max-width:420px;width:95%;text-align:center;box-shadow:0 30px 80px rgba(0,0,0,.3)}
  .popup h2{font-size:2.4rem;color:#ee4d2d;font-weight:900;margin:0 0 40px}
  .popup-shape-img{width:110px;height:110px;border-radius:50%;object-fit:cover;border:6px solid #ee4d2d;margin:20px auto 30px;box-shadow:0 10px 30px rgba(238,77,45,.4)}
  .shape-name{font-size:4.2rem;font-weight:900;color:#ee4d2d;margin:20px 0 10px;line-height:1}
  .team-text{font-size:1.6rem;color:#333;margin:20px 0 45px;line-height:1.5}
  .team-name{color:#ee4d2d;font-weight:900;font-size:2rem}
  .popup button{background:#ee4d2d;color:#fff;padding:18px 90px;font-size:1.55rem;font-weight:700;border-radius:50px;border:none;cursor:pointer;box-shadow:0 12px 35px rgba(238,77,45,.4)}
 </style>
</head>
<body>
<h1>Team Shape Selection 2025</h1>
<div id="step1">
 <strong style="font-size:1.4rem">Choose your team</strong><br><br>
 <select id="team" onchange="pickTeam()">
  <option value="">-- Select Team --</option>
  <option>BD</option><option>CP</option><option>Driver</option>
  <option>Ops</option><option>People</option><option>Product</option>
  <option>S&P - BnP & MS</option>
  <option>S&P - Demand</option><option>S&P - Platform Health</option>
 </select>
</div>
<div id="step2" style="display:none">
 <p style="font-size:1.4rem;margin:30px 0"><strong><span id="teamName"></span> — Tap your favourite shape</strong></p>
 <div class="images" id="grid"></div>
 <button onclick="location.reload()">Change Team</button>
</div>
<div id="admin" style="margin:80px 0 30px;font-size:1.4rem">
 <a href="#" onclick="showResults();return false;">Owner: Click here to see all choices</a>
</div>
<!-- CLEAN POPUP -->
<div class="popup-overlay" id="popup">
 <div class="popup">
  <h2>Congratulations!</h2>
  <div id="popupImageContainer"></div>
  <div class="shape-name" id="selectedShape"></div>
  <div class="team-text">
   is selected to represent<br>
   <span class="team-name" id="selectedTeam"></span> team
  </div>
  <button onclick="closePopup()">Got it!</button>
 </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
// Your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBv48DOi1AsTujR_Uh91vjzGZQY9lv5xKE",
  authDomain: "year-end-2025.firebaseapp.com",
  projectId: "year-end-2025",
  storageBucket: "year-end-2025.firebasestorage.app",
  messagingSenderId: "324064058034",
  appId: "1:324064058034:web:abf554f233634cf40b47ab"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const choicesRef = db.collection("choices").doc("2025");

let choices = {};

async function loadChoices() {
  const doc = await choicesRef.get();
  choices = doc.exists ? doc.data() : {};
}

async function saveChoice(team, file) {
  await choicesRef.set({ [team]: file }, { merge: true });
}

(async () => {
  await loadChoices();
})();

const shapeNames = ["ARROW","CIRCLE","CRESCENT","CROSS","HEART","HEXAGON","OVAL","PENTAGON","PIE","RECTANGLE","STAR","SQUARE","SPIRAL","RIGHT TRIANGLE","RHOMBUS"];
const imageFiles = shapeNames.map(n => `image/${n}`);

const teams = ["S&P - BnP & MS","S&P - Demand","S&P - Platform Health","BD","CP","Driver","Ops","Product","People"];

function pickTeam() {
 const team = document.getElementById("team").value;
 if (!team) return;
 if (choices[team]) {
  alert("This team has already chosen a shape!");
  document.getElementById("team").selectedIndex = 0;
  return;
 }
 document.getElementById("step1").style.display = "none";
 document.getElementById("step2").style.display = "block";
 document.getElementById("teamName").textContent = team;
 loadImages();
}

function loadImages() {
 const grid = document.getElementById("grid");
 grid.innerHTML = "";
 imageFiles.forEach(file => {
  const name = file.split('/').pop();
  const taken = Object.keys(choices).find(t => choices[t] === file);
  const box = document.createElement("div");
  box.className = "box" + (taken ? " taken" : "");
  box.innerHTML = `
   <img src="${file}.jpg" onerror="this.src='${file}.png'" onerror="this.src='${file}.webp'">
   <div class="label">${taken ? "Taken by "+taken : name}</div>
  `;
  if (!taken) box.onclick = () => selectImage(teamName.textContent, file, name);
  grid.appendChild(box);
 });
}

async function selectImage(team, file, shapeName) {
 if (choices[team]) return;
 await saveChoice(team, file);
 choices[team] = file;

 document.getElementById("popupImageContainer").innerHTML = `
  <img class="popup-shape-img" src="${file}.jpg"
       onerror="this.src='${file}.png'"
       onerror="this.src='${file}.webp'">
 `;

 document.getElementById("selectedShape").textContent = shapeName;
 document.getElementById("selectedTeam").textContent = team;

 document.getElementById("popup").style.opacity = "1";
 document.getElementById("popup").style.visibility = "visible";

 confetti({particleCount:400,spread:120,origin:{y:0.55},colors:['#ee4d2d','#ff6b6b','#1a73e8']});
}

function closePopup() {
 document.getElementById("popup").style.opacity = "0";
 setTimeout(() => location.reload(), 800);
}

async function showResults() {
 await loadChoices();
 let txt = "TEAM SHAPE SELECTIONS 2025\n\n";
 teams.forEach(t => txt += `${t} → ${choices[t]?choices[t].split('/').pop():"Not chosen yet"}\n`);
 alert(txt);
}
</script>
</body>
</html>
